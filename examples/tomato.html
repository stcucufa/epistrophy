<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Flipbook animation example (tomato) | Epistrophy</title>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="stylesheet" href="style.css"/>
        <script type="module">
import Scheduler from "../lib/scheduler.js";
import Fiber, { First, All } from "../lib/fiber.js";
import { loadImage } from "../lib/util.js";

const N = 18;
const FPS = 9;

const screen = document.querySelector(".screen");

const fiber = Scheduler.run().
    lift(fiber => {
        for (const src of new Array(N).fill().map((_, i) => `tomato/tomato${(i + 1).toString().padStart(2, "0")}.png`)) {
            fiber.spawn(fiber => fiber.exec(async () => loadImage(src)));
        }
    }).
    join(All).
    repeat(fiber => fiber.
        lift(fiber => {
            for (let i = 0; i < N; ++i) {
                fiber.
                    effect(({ value: images }) => {
                        screen.innerHTML = "";
                        screen.appendChild(images[i]);
                    }).
                    delay(1000 / FPS);
            }
        })
    );

        </script>
    </head>
    <body>
        <h1>Flipbook animation example (tomato)</h1>
        <div class="example">
            <div class="screen"></div>
        </div>
        <h2>Source</h2>
        <pre></pre>
        <p><a href="index.html">Back</a></p>
        <script>document.querySelector("pre").textContent = document.querySelector("script").textContent;</script>
    </body>
</html>
